# -*- coding: utf-8 -*-
"""
Created on Thu May 16 10:28:43 2024

@author: natha
"""



import matplotlib.pyplot as plt
import matplotlib as mpl
import glob as gl

import re


plt.close('all')

mpl.rcParams['mathtext.fontset'] = 'stix'
mpl.rcParams['font.family'] = 'STIXGeneral'




mpl.rcParams['xtick.major.width'] = 3
mpl.rcParams['xtick.major.size'] = 9
mpl.rcParams['ytick.major.width'] = 3
mpl.rcParams['ytick.major.size'] = 9
mpl.rcParams['xtick.minor.width'] = 1
mpl.rcParams['xtick.minor.size'] = 2.5
mpl.rcParams['ytick.minor.width'] = 1
mpl.rcParams['ytick.minor.size'] = 2.5
mpl.rcParams['xtick.direction'] = 'in'
mpl.rcParams['ytick.direction'] = 'in'
mpl.rcParams['xtick.top'] = True
mpl.rcParams['ytick.right'] = True
plt.rcParams['xtick.labelsize']=20
plt.rcParams['ytick.labelsize']=35


plt.rcParams['axes.labelsize'] = 25
plt.rcParams['axes.titlesize'] = 25
# mpl.rcParams['axes.grid'] = True
# mpl.rcParams['axes.grid.axis'] = 'both'
# mpl.rcParams['axes.grid.which'] = 'major'
# mpl.rcParams['grid.alpha'] = 1



#mpl.rcParams['font.size']=25
mpl.rcParams['axes.linewidth'] = 2
mpl.rcParams["savefig.format"]='svg'
mpl.rcParams['lines.markersize'] = 10
mpl.rcParams['lines.linewidth'] = 5
mpl.rcParams['legend.fontsize'] = 20

h=4.135*10**(-15)
c=299792458


def grep(path,pattern):
    
    L=[]

    with open(path, "r") as file:
        for line in file:
            if re.search(pattern, line):
                #print(line)
                L.append(line)
    return L

def ABS(path_file_TD):
    L=grep(path_file_TD,"Excited State")
    WL=[]
    I=[]
    N=len(L)
    for k in range(N):
        i=0
        j=0
        while L[k][i] !='V' :
            i=i+1
        while L[k][j:j+2] !='nm' :
            j=j+1
        WL.append(float(L[k][i+1:j]))
    for k in range(N):
        i=0
        j=0
        while L[k][i:i+2] !='f=' :
            i=i+1
        while L[k][j:j+2] !='<S' :
            j=j+1
        I.append(float(L[k][i+2:j]))
    return WL,I


path='D:/STAGE/Rh3Per/V1/SINGLETS/PBE0/td_sequential'
path_fig = 'D:/STAGE/FIGURE'

path_meta=path+'td_*.com.out'


ListOfFiles = gl.glob('D:/STAGE/Rh3Per/V1/SINGLETS/PBE0/td_sequential/*.com.out')

theta_0=[i/2 for i in range(0,721)]

S_0 = [0.685081281366183,
0.695655087182608,
0.706251206333798,
0.716862563881077,
0.727491608836918,
0.738167729511888,
0.748900177783138,
0.759692491144754,
0.770552832992278,
0.781471407238687,
0.792444132180022,
0.803431279159331,
0.814420058817748,
0.825356864707339,
0.836234349741181,
0.846961899962732,
0.857831493699783,
0.868753061205659,
0.879729051505211,
0.890758648265072,
0.901835048632938,
0.912937844064275,
0.924021591506689,
0.934999486608845,
0.945812208514997,
0.956614862198255,
0.967461598353547,
0.978358675598557,
0.989323781341849,
1.00032888785322,
1.01138678446678,
1.02248631452753,
1.03362394054137,
1.04451203803273,
1.05489291500931,
1.06519379048687,
1.07546908723433,
1.08563907587614,
1.09556144077332,
1.10549006428819,
1.11535011508253,
1.12509832701768,
1.13473497220475,
1.14427746596595,
1.15373152265958,
1.16313088444841,
1.17248507532072,
1.18183572869894,
1.19115672165547,
1.20037376706198,
1.20941121723451,
1.21825111262863,
1.226984067238,
1.23564980968246,
1.24429323877978,
1.25292333428361,
1.26176785562868,
1.26931276050585,
1.27701794052933,
1.28463223447277,
1.29218938448656,
1.29970925488062,
1.30714830740516,
1.31466926625609,
0.173391312918827,
0.167751206043033,
0.16221559093951,
0.156785011842878,
0.151463550457093,
0.146252023127897,
0.141150701966411,
0.136160403318378,
0.131281399307293,
0.126514234130653,
0.121859724171322,
0.117317869392176,
0.112888397694469,
0.108571309090573,
0.104365787222375,
0.100269927287268,
0.0962826408531384,
0.0924017509815106,
0.0886278019193776,
0.0849583446295161,
0.0813922906550624,
0.0779274630946641,
0.0745622292568388,
0.0712946843389818,
0.0681237398966041,
0.0650480353617199,
0.0620667543762136,
0.0591782642609774,
0.0563822929172631,
0.0536782960980777,
0.0510657295811765,
0.0485443212554373,
0.0461135268986154,
0.0437728022637178,
0.0415221473754929,
0.03936129009807,
0.037289958332701,
0.0353073357336448,
0.0334126059427858,
0.0316054968737505,
0.0298846479338044,
0.0282495149130774,
0.0266990093423316,
0.0252325869993224,
0.0238494315259344,
0.0225498150704128,
0.0213217645825111,
0.0201748040752522,
0.0191026749185778,
0.0181034723098832,
0.017176107792305,
0.016324663094549,
0.0155295459806988,
0.0148100765631742,
0.0141610846811546,
0.0134154923112815,
0.0109765345341709,
0.0101582877398145,
0.00939528008487468,
0.00868152506278966,
0.00801158038924214,
0.00737864322430341,
0.00678108087649116,
0.00621590009871161,
0.00568310089096476,
0.0051826832408763,
0.00471437504969827,
0.00427926476191979,
0.00387816873565635,
0.00351353597100851,
0.00318618282609177,
0.00289719775776957,
0.00264658076604192,
0.0024343318509088,
0.00226099522224049,
0.00212629879366332,
0.00203078678742186,
0.0019744591911418,
0.00195704389370085,
0.00197962935196247,
0.0020413992325598,
0.00214262563424081,
0.00228385280399871,
0.00246453649484029,
0.00268304404003184,
0.00293692640234985,
0.00322455090268631,
0.0035440127384366,
0.00389340711937039,
0.00427164557624992,
0.00467791177570835,
0.0051203691380344,
0.00559085424293935,
0.0061168506107575,
0.00654080421877916,
0.00689074282195752,
0.00727306299516858,
0.0076771522809001,
0.00809620783922337,
0.00852723642304463,
0.0089672447605215,
0.00941405595030137,
0.00985977868321779,
0.0102959774154854,
0.0107093185907434,
0.0111115030738703,
0.0115000818647655,
0.0118913818040065,
0.0122894845831762,
0.0127003767212107,
0.0131259630207147,
0.0135730463216169,
0.014051150624566,
0.014584766178054,
0.0153347123630067,
0.0152634184941348,
0.0187557295624932,
0.0159134988330179,
0.0154683203347204,
0.0152408330234989,
0.0154389320241557,
0.0183317759544715,
0.0174014181897996,
0.0188123292822698,
0.0191717918737227,
0.0195108459206408,
0.0198221443361023,
0.0201595656915381,
0.0204782111815473,
0.0207916865107357,
0.021107338753651,
0.0214210861939618,
0.0217291192388329,
0.0220259956163216,
0.0223065451532328,
0.0225672303678538,
0.0228007041732628,
0.0230085992733164,
0.0231816637784881,
0.0222469521863623,
0.0222896740780364,
0.0223372940317831,
0.0223944379738044,
0.022458112644632,
0.0225264132664101,
0.0225865504555251,
0.0226007003823756,
0.0217938823788983,
0.0215870757357082,
0.0218578291608483,
0.0217636777225925,
0.0215598643388705,
0.0213478875348596,
0.0211750951408102,
0.0210384939096284,
0.0209342742484793,
0.0208695111207882,
0.0208504631318649,
0.0208809399116673,
0.0209631183367994,
0.0210956378516496,
0.0212771378882324,
0.0215068021008065,
0.0217868074154731,
0.0221163374617424,
0.0224951201532408,
0.0229305025521416,
0.023425750029035,
0.0239833116211447,
0.0246059084520678,
0.02529626167015,
0.0260587251028453,
0.0268930266266569,
0.0277964451056134,
0.028786667948278,
0.0298468240918288,
0.0308952793333781,
0.0319981573809772,
0.0331516486170425,
0.0343620116963811,
0.0356295187053665,
0.0369593398295682,
0.0383561009828136,
0.0398236117826862,
0.0413667702788845,
0.0429814947550768,
0.0446533631732904,
0.0464104032761041,
0.0473336860773507,
0.0489421519234847,
0.0506006867605888,
0.0523248010587509,
0.0541267399669656,
0.0560043265715059,
0.057982323231986,
0.0600675328130833,
0.0622651254879927,
0.0645772781456926,
0.0670078003913922,
0.0695632229662721,
0.0722473554631674,
0.0750618305611861,
0.0780126347792642,
0.0811000402161499,
0.0843229584397282,
0.0876830221043585,
0.0911824081485164,
0.0948235655846768,
0.0986062223017174,
0.102519493731004,
0.106579706725487,
0.110779786309369,
0.11512517477934,
0.119607980813859,
0.124229564993288,
0.128987750391523,
0.133834644968446,
0.138830657999545,
0.143961367471595,
0.149212623445371,
0.154620889194865,
0.160168477311511,
0.165855387795311,
0.171677811053429,
0.177636019196987,
0.183728107435756,
0.189953803633865,
0.19631365205068,
0.202807108426835,
0.209435805466186,
0.216201103736718,
0.223104908028663,
0.23014857892238,
0.237331844294372,
0.244654432033518,
0.252115797917572,
0.259714853477297,
0.26744996604596,
0.275319775030825,
0.283325096802383,
0.291451781409034,
0.299712346110896,
0.308095906339334,
0.316605183230319,
0.325242081586455,
0.334010683124075,
0.342909355151697,
0.351937009212455,
0.361100992393274,
0.370400216237288,
0.379837129756973,
0.389414454100675,
0.399137087318092,
0.409007206322951,
0.419027804374721,
0.42920078626363,
0.439527512557666,
0.450009071726066,
0.460646007991074,
0.471437505006949,
0.482383562761318,
0.493482820710942,
0.504733918275463,
0.5161349506399,
0.527684285149894,
0.539380016978093,
0.551220513457763,
0.563198427514355,
0.575324643691756,
0.587589638014066,
0.599992049913299,
0.612529974574476,
0.62518599671253,
0.637953585586281,
0.650835734467571,
0.663809313638771,
0.673563239969358,
0.686118307816853,
0.698792017375845,
0.711579742683008,
0.724482844343452,
0.737499417529823,
0.75062891803225,
0.763868352578892,
0.777213911601661,
0.790660152791493,
0.804205987716272,
0.817837810659019,
0.831549090890925,
0.845325678485142,
0.859199954999327,
0.873058993129798,
0.886984699202939,
0.900986325071154,
0.915059516919362,
0.929197199796514,
0.943384407405269,
0.957586853410112,
0.970291583958776,
0.984117152074725,
0.997925304880859,
1.01172012411826,
1.02548609926734,
1.03920091698096,
1.05286539360486,
1.06648116181815,
1.08005257544828,
1.09357881816189,
1.1070582572675,
1.12046531404737,
1.13373576959606,
1.14683833081277,
1.15980837251463,
1.17263691492324,
1.18531225716134,
1.19784936548915,
1.2102384437949,
1.22236030614485,
1.23429821944574,
0.665699417491054,
0.652758764099757,
0.639952535038289,
0.627286444677342,
0.614770289128685,
0.602383659847785,
0.590151591330127,
0.578074899896703,
0.566139979855281,
0.554356083083014,
0.542711236566778,
0.531238910321094,
0.519910804504637,
0.508733994068457,
0.497710111704036,
0.486838885287878,
0.476120859054601,
0.465554944547342,
0.455140053309238,
0.444875369006922,
0.434759531060034,
0.424791995233954,
0.414972761541058,
0.4053012857591,
0.395777839986829,
0.386401607890877,
0.377172589458871,
0.368090512604437,
0.359154016722466,
0.350361741269721,
0.341711509320101,
0.333201143972252,
0.324828468312449,
0.316590216957727,
0.30848394089561,
0.300508279558113,
0.292663777167481,
0.284950705834836,
0.277370426140537,
0.269923754417952,
0.262610690667081,
0.255431506999046,
0.248385114969358,
0.241469881886534,
0.234683358725725,
0.228024184918947,
0.221491544120456,
0.215081082515175,
0.208798242362671,
0.19840566448408,
0.19224554774703,
0.186218494759449,
0.180333485287366,
0.17458807029356,
0.168981977654532,
0.163514663172787,
0.158186126823577,
0.15299500805129,
0.147941034720054,
0.143023934743498,
0.138242075417762,
0.133594912532979,
0.129079997039549,
0.124697056838724,
0.120307313797971,
0.116084104521209,
0.11197382254813,
0.107975651545366,
0.104088775167176,
0.100314009759302,
0.0966459130374262,
0.093084485013923,
0.0896270045280722,
0.0862712946785214,
0.0830130016378166,
0.079846683134015,
0.0767693459076484,
0.0737790851684866,
0.0708769893486443,
0.0680622421395034,
0.065334027170574,
0.0615165398710258,
0.0588952657115913,
0.056377666978687,
0.0539653763637953,
0.0516605707930173,
0.0494605290932586,
0.0473663397585057,
0.0453750095045419,
0.0434821845162876,
0.0416854157812679,
0.0399841590524897,
0.0383718836011465,
0.0368494057729796,
0.0354148207653842,
0.0340697612574685,
0.0328150436073479,
0.0316520283706338,
0.0305815318930674,
0.0296046426315122,
0.0287208163637235,
0.0279286925093414,
0.0272258220435166,
0.0266081232622919,
0.0260726029061992,
0.0256127302464322,
0.0252181649489752,
0.0249000636812107,
0.0246619639372256,
0.0244799196660239,
0.0243659039054781,
0.024311208988306,
0.0243025013457727,
0.0243351550269277,
0.0244078094637853,
0.0245226415700723,
0.0252706829524203,
0.0252489138398999,
0.0252581657046778,
0.0252546282229651,
0.0252113620966722,
0.0250826521746569,
0.0248747570869776,
0.0246385621332228,
0.0243637269917512,
0.0240810005411131,
0.0237664367674355,
0.0234671113650977,
0.0231925483347483,
0.0229560812698713,
0.0227669620352443,
0.0226088638026644,
0.022490766325787,
0.0224132138392311,
0.0223751178737588,
0.0223797438123349,
0.0224385204458385,
0.0225449170207145,
0.0227209747729799,
0.023183840692215,
0.0232056098047355,
0.025773549627358,
0.0217658546363195,
0.0209522337681648,
0.0205862404479056,
0.0203021534292818,
0.0201165716763675,
0.0200988842678043,
0.0196428212008722,
0.0197211900331693,
0.0152549829503495,
0.0180036064638136,
0.0151104904223756,
0.0175064541966898,
0.0155232873630147,
0.0171363791477247,
0.0160413924216664,
0.0159099613513053,
0.015731182450694,
0.0159309141304589,
0.0158971719924404,
0.0158343136673539,
0.0150933472360569,
0.0144538793423118,
0.0138886985645322,
0.0133959001124879,
0.0129558917750111,
0.0114132775010574,
0.0108946282201611,
0.0104048230152106,
0.00995202531886889,
0.00953405821740908,
0.00914956114284542,
0.00879880619392589,
0.00848070492616134,
0.00819552945067408,
0.00794518457006871,
0.00772259532091994,
0.00752612901174543,
0.00671604563767778,
0.00613617069842876,
0.00570269310213262,
0.00530377397722177,
0.00493750853346592,
0.00461015538854917,
0.00431708861626976,
0.00395354430848538,
0.0036710899813439,
0.00341448647068009,
0.0031810126652711,
0.00296985219462713,
0.0027810050834968,
0.00261256651690119,
0.00246344803797683,
0.00232031607798863,
0.00218289851343998,
0.00205337224568348,
0.00165227620704572,
0.00130886834504809,
0.00100056317668032,
0.000728449183554494,
0.00049415902003002,
0.000303679229791669,
0.000157554010335389,
0.0000574160531435155,
0.00000462593857610045,
0,
0.0000429940151706433,
0.000136329120059509,
0.000279461080047713,
0.00047293412975414,
0.000718925195280008,
0.001019339042107,
0.00137281512699801,
0.00177935344995303,
0.00224357993717385,
0.00277066474948115,
0.00257719169977472,
0.00315135223120988,
0.00379272493993394,
0.00450484727053663,
0.00525642613459731,
0.00605235959418869,
0.00691332828021914,
0.00784205336578307,
0.00884125597447765,
0.00991528993375669,
0.0110652437004836,
0.0122932941760111,
0.0136018904099369,
0.0149926650566204,
0.0164669787087961,
0.0180261919344495,
0.0196711210669477,
0.0214031266742762,
0.0232241135590399,
0.0251354423015986,
0.0271259562098213,
0.0292076283092059,
0.0313774653402845,
0.0336335625128266,
0.03597564771571,
0.0384029045908192,
0.0409153331505285,
0.043514293975198,
0.0461938005335172,
0.0489601114555445,
0.0518105056053085,
0.053839659701248,
0.0567923687095565,
0.0598370522547681,
0.0629777920532143,
0.0662113227095562,
0.0695455355577089,
0.0729796142271825,
0.0765151914342081,
0.0801519950429147,
0.0838938346585115,
0.0876095513217598,
0.09148309411884,
0.095456230626119,
0.0995292329794675,
0.103701012722022,
0.107974835199625,
0.112347707177556,
0.116820445001556,
0.121393864992619,
0.126066878718629,
0.130839214056089,
0.135710054646885,
0.140678312058902,
0.145742625711778,
0.150903267729012,
0.156162142888458,
0.161523060807701,
0.166987654153474,
0.172561909444714,
0.17824256131083,
0.184044576012039,
0.189958701695937,
0.195988747930613,
0.202137707987906,
0.208404493410955,
0.214785838829168,
0.221288002847856,
0.227906359565566,
0.234639548377188,
0.241484576048003,
0.248438993540788,
0.255498447052838,
0.262658854843072,
0.269979265668491,
0.277330153273712,
0.28478036247801,
0.292323634663699,
0.299962690991502,
0.307692905498091,
0.31524570168443,
0.320391377429072,
0.3281322043808,
0.33595983570861,
0.343886788647871,
0.351900545938465,
0.360004917197978,
0.36819582072245,
0.376472984363637,
0.38483940141813,
0.393290173799108,
0.401828566889535,
0.410462471998578,
0.419189984323632,
0.428017634593504,
0.436945967042812,
0.445978247042147,
0.455116651505235,
0.464356010271257,
0.473708024217464,
0.483164529948318,
0.492723350537715,
0.502385574454895,
0.512146847860029,
0.522005810197506,
0.531957835516374,
0.541995576742088,
0.552118761775898,
0.56231759449366,
0.572569217325989,
0.582854854419833,
0.59315164818106,
0.603453884214229,
0.613777345150049,
0.622772889764272,
0.632973355161141,
0.643269332576627,
0.653628168329573,
0.664057753729146,
0.674547204194338,
0.685082914045291,
]
S_0_ref = [S_0[i*10] for i in range(0,72)]






n=4 #amount_of_PEs_chosen
N=len(ListOfFiles)


fig, ax = plt.subplots(figsize=(14,7))

S=[[] for i in range(n)]
nom_etat=['S'+ str(k+1) for k in range(n)]


theta=[i*5 for i in range(0,72)]

states=[[] for i in range(n)]
wltrans=[[] for i in range(n)]
Energy=[[] for i in range(n)]

for i in range(N):
    wl,f = ABS(ListOfFiles[i])
    j=0
    while j < n:
        states[j].append([i+1,f[j],h*c/(wl[j]*10**(-9)),wl[j]])
        wltrans[j].append(wl[j])
        Energy[j].append(h*c/(wl[j]*10**(-9)))
        j=j+1
        
        
for k in range(n):
    for l in range(len(S_0_ref)):
        S[k].append(Energy[k][l] + S_0_ref[l])

print(S[0])
print(Energy[0])
print(S_0_ref)
        
        
ax.plot(theta_0,S_0,'r',label='S0')


for k in range(n):
    c=mpl.colormaps['viridis'](k/n)
    ax.plot(theta,S[k],color=c,label=nom_etat[k])

#ax.plot(WL1,I1)
    
ax.set_ylabel(r"Energy (eV)",fontsize=25)
ax.set_xlabel(r"Dihedral angle (°)",fontsize=25)
ax.grid(True)
ax.legend(loc='upper right')
plt.subplots_adjust(left=0.1, bottom=0.13, right=0.99, top=0.96, hspace=0.05,wspace=0.05)

plt.savefig('D:/STAGE/FIGURE/Dihedral_scan_excited_states.png', dpi=300)

